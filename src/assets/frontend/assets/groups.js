import{d as ee,u as se,r as P,c as z,w as V,o as ae,a as J,b as te,p as A,_ as oe,e as n,f as a,g as b,h as ne,i as ie,j as le,t as d,n as B,k as M,l as L,v as re,m as Q,F as U,q as W,s as i}from"./index.js";const ue=ee({setup(){const s=se(),e=te(),h=s.params.token,y=P([]),T=P({}),N=P(!1),E=P(""),t=P(""),C=P("card"),p=P(1),$=P(24),G=z(()=>{if(!t.value)return y.value;const o=t.value.toLowerCase();return y.value.filter(r=>{var g;return((g=r.Name)==null?void 0:g.toLowerCase().includes(o))||r.JID.toLowerCase().includes(o)})}),w=z(()=>Math.ceil(G.value.length/$.value)||1),q=z(()=>{const o=(p.value-1)*$.value,r=o+$.value;return G.value.slice(o,r)});async function S(){var o,r,g;N.value=!0,E.value="";try{const m=((o=(await J.get(`/api/groups/getall?token=${encodeURIComponent(h)}`)).data)==null?void 0:o.groups)||[];m.sort((v,R)=>{const D=v.Name||"",l=R.Name||"";return D.localeCompare(l)}),y.value=m,H(m.slice(0,20)),K()}catch(u){E.value=((g=(r=u==null?void 0:u.response)==null?void 0:r.data)==null?void 0:g.result)||(u==null?void 0:u.message)||"Erro ao carregar grupos"}finally{N.value=!1}}V([t,$],()=>{p.value=1}),V([G,w],()=>{p.value>w.value&&(p.value=w.value),p.value<1&&(p.value=1)});function F(o){o>=1&&o<=w.value&&(p.value=o)}function j(){p.value<w.value&&p.value++}function O(){p.value>1&&p.value--}async function H(o){var r;for(const g of o)try{const u=await J.get(`/api/picinfo/${encodeURIComponent(g.JID)}?token=${encodeURIComponent(h)}`);(r=u.data)!=null&&r.url&&(T.value[g.JID]=u.data.url)}catch{}}async function K(){var o,r,g,u,m;try{const R=((o=(await J.get(`/api/server/${h}/messages`)).data)==null?void 0:o.messages)||[],D={};for(const l of R){const c=(r=l.chat)==null?void 0:r.id;if(!(!c||!c.endsWith("@g.us"))&&!(l.type==="unhandled"||l.type==="revoked"||l.type==="system")&&((g=l.debug)==null?void 0:g.reason)!=="discard"&&!(!l.text&&!l.attachment&&!l.inreply)&&(!D[c]||new Date(l.timestamp)>new Date(D[c].timestamp))){let f=l.text||"";if(l.attachment){const k=l.attachment.mimetype||"";let I="";k.startsWith("image/")?I="üì∑ ":k.startsWith("video/")?I="üé• ":k.startsWith("audio/")||l.type==="ptt"?I="üéµ ":k.includes("pdf")?I="üìÑ ":I="üìé ",f?f=I+f:k.startsWith("image/")?f="üì∑ Imagem":k.startsWith("video/")?f="üé• V√≠deo":k.startsWith("audio/")||l.type==="ptt"?f="üéµ √Åudio":k.includes("pdf")?f="üìÑ PDF":f="üìé Arquivo"}if(l.type==="sticker"&&(f="üè∑Ô∏è Sticker"),!f&&l.inreply&&(f="‚Ü©Ô∏è Resposta"),!f)continue;D[c]={timestamp:l.timestamp,senderName:((u=l.participant)==null?void 0:u.title)||((m=l.participant)==null?void 0:m.phone)||"Desconhecido",text:f}}}y.value=y.value.map(l=>({...l,lastMessage:D[l.JID]})),y.value.sort((l,c)=>l.lastMessage&&c.lastMessage?new Date(c.lastMessage.timestamp).getTime()-new Date(l.lastMessage.timestamp).getTime():l.lastMessage?-1:c.lastMessage?1:(l.Name||"").localeCompare(c.Name||""))}catch{}}function X(o){delete T.value[o]}function Y(o){if(!o)return"";const r=new Date(o),g=new Date,u=g.getTime()-r.getTime(),m=24*60*60*1e3;return u<m&&r.getDate()===g.getDate()?r.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}):u<2*m?"Ontem":u<7*m?r.toLocaleDateString("pt-BR",{weekday:"short"}):r.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"})}function Z(o,r=50){return o?o.length<=r?o:o.substring(0,r)+"...":""}function _(o){e.push(`/server/${h}/groups/${encodeURIComponent(o)}`)}async function x(){var u,m;const o=prompt("Nome do grupo (<=25 caracteres):");if(!o)return;const r=prompt("Participantes (telefone separados por v√≠rgula):");if(!r)return;const g=r.split(",").map(v=>v.trim()).filter(Boolean);try{await J.post("/api/groups/create",{title:o,participants:g,token:h}),A("Grupo criado","success"),await S()}catch(v){A(((m=(u=v==null?void 0:v.response)==null?void 0:u.data)==null?void 0:m.result)||(v==null?void 0:v.message)||"Erro ao criar grupo","error")}}return ae(()=>{S()}),{token:h,groups:y,groupPictures:T,loading:N,error:E,searchQuery:t,viewMode:C,filteredGroups:G,displayGroups:q,currentPage:p,totalPages:w,pageSize:$,createGroup:x,load:S,goToGroup:_,goToPage:F,nextPage:j,prevPage:O,handleImageError:X,formatTime:Y,truncateMessage:Z}}}),de={class:"groups-page"},pe={class:"page-header"},ge={class:"header-left"},me={key:0,class:"group-count"},fe={class:"header-actions"},ve={class:"view-toggle"},ce={class:"search-bar"},be={key:0,class:"pagination-controls"},ye=["disabled"],ke=["disabled"],Pe={class:"page-info"},he=["disabled"],Ce=["disabled"],Me=["disabled"],we={key:1,class:"loading-container"},De={key:2,class:"error-box"},Ie={key:3,class:"empty-state"},Ee={key:0},$e={key:1},Te={key:4,class:"groups-grid"},Ne=["onClick"],Ge={class:"card-avatar"},Je=["src","alt","onError"],Se={key:1,class:"avatar-placeholder"},Re={class:"card-content"},ze={class:"card-header"},Be={class:"group-name"},Le={key:0,class:"message-time"},Ve={class:"card-body"},Ae={key:0,class:"last-message"},Qe={class:"sender-name"},Ue={key:1,class:"last-message empty"},We={class:"card-footer"},qe={class:"participants-count"},Fe={key:0,class:"badge badge-announce",title:"Apenas admins podem enviar"},je={key:1,class:"badge badge-community",title:"Comunidade"},Oe={key:5,class:"groups-list"},He=["onClick"],Ke={class:"item-avatar"},Xe=["src","alt","onError"],Ye={key:1,class:"avatar-placeholder"},Ze={class:"item-content"},_e={class:"item-header"},xe={class:"group-name"},es={key:0,class:"message-time"},ss={class:"item-body"},as={key:0,class:"last-message"},ts={class:"sender-name"},os={key:1,class:"last-message empty"},ns={class:"participants-info"},is={class:"item-badges"},ls={key:0,class:"badge badge-announce",title:"Apenas admins podem enviar"},rs={key:1,class:"badge badge-community",title:"Comunidade"},us={key:6,class:"pagination-controls"},ds=["disabled"],ps=["disabled"],gs={class:"page-info"},ms=["disabled"],fs=["disabled"],vs=["disabled"];function cs(s,e,h,y,T,N){const E=le("router-link");return i(),n("div",de,[a("div",pe,[a("div",ge,[ne(E,{to:`/server/${s.token}`,class:"back-btn"},{default:ie(()=>[...e[16]||(e[16]=[a("i",{class:"fa fa-arrow-left"},null,-1)])]),_:1},8,["to"]),e[17]||(e[17]=a("h1",null,"Grupos",-1)),s.groups.length>0?(i(),n("span",me,"("+d(s.groups.length)+")",1)):b("",!0)]),a("div",fe,[a("div",ve,[a("button",{class:B(["toggle-btn",{active:s.viewMode==="card"}]),onClick:e[0]||(e[0]=t=>s.viewMode="card"),title:"Modo Card"},[...e[18]||(e[18]=[a("i",{class:"fa fa-th-large"},null,-1)])],2),a("button",{class:B(["toggle-btn",{active:s.viewMode==="list"}]),onClick:e[1]||(e[1]=t=>s.viewMode="list"),title:"Modo Lista"},[...e[19]||(e[19]=[a("i",{class:"fa fa-list"},null,-1)])],2)]),a("button",{onClick:e[2]||(e[2]=(...t)=>s.load&&s.load(...t)),class:"btn-icon",title:"Atualizar"},[a("i",{class:B(["fa fa-refresh",{"fa-spin":s.loading}])},null,2)]),a("button",{onClick:e[3]||(e[3]=(...t)=>s.createGroup&&s.createGroup(...t)),class:"btn-primary"},[...e[20]||(e[20]=[a("i",{class:"fa fa-plus me-2"},null,-1),M("Criar grupo ",-1)])])])]),a("div",ce,[e[22]||(e[22]=a("i",{class:"fa fa-search"},null,-1)),L(a("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>s.searchQuery=t),type:"text",placeholder:"Pesquisar grupos...",class:"search-input"},null,512),[[re,s.searchQuery]]),s.searchQuery?(i(),n("button",{key:0,onClick:e[5]||(e[5]=t=>s.searchQuery=""),class:"clear-search"},[...e[21]||(e[21]=[a("i",{class:"fa fa-times"},null,-1)])])):b("",!0)]),s.groups.length>0?(i(),n("div",be,[a("button",{onClick:e[6]||(e[6]=t=>s.goToPage(1)),disabled:s.currentPage===1||s.loading,class:"btn-page"},[...e[23]||(e[23]=[a("i",{class:"fa fa-angle-double-left"},null,-1)])],8,ye),a("button",{onClick:e[7]||(e[7]=(...t)=>s.prevPage&&s.prevPage(...t)),disabled:s.currentPage===1||s.loading,class:"btn-page"},[...e[24]||(e[24]=[a("i",{class:"fa fa-angle-left"},null,-1)])],8,ke),a("span",Pe,"P√°gina "+d(s.currentPage)+" de "+d(s.totalPages),1),a("button",{onClick:e[8]||(e[8]=(...t)=>s.nextPage&&s.nextPage(...t)),disabled:s.currentPage>=s.totalPages||s.loading,class:"btn-page"},[...e[25]||(e[25]=[a("i",{class:"fa fa-angle-right"},null,-1)])],8,he),a("button",{onClick:e[9]||(e[9]=t=>s.goToPage(s.totalPages)),disabled:s.currentPage>=s.totalPages||s.loading,class:"btn-page"},[...e[26]||(e[26]=[a("i",{class:"fa fa-angle-double-right"},null,-1)])],8,Ce),L(a("select",{"onUpdate:modelValue":e[10]||(e[10]=t=>s.pageSize=t),class:"page-size-select",disabled:s.loading},[...e[27]||(e[27]=[a("option",{value:5},"5 por p√°gina",-1),a("option",{value:10},"10 por p√°gina",-1),a("option",{value:15},"15 por p√°gina",-1),a("option",{value:25},"25 por p√°gina",-1),a("option",{value:50},"50 por p√°gina",-1),a("option",{value:100},"100 por p√°gina",-1),a("option",{value:200},"200 por p√°gina",-1)])],8,Me),[[Q,s.pageSize,void 0,{number:!0}]])])):b("",!0),s.loading?(i(),n("div",we,[...e[28]||(e[28]=[a("div",{class:"loading-spinner"},null,-1),a("p",null,"Carregando grupos...",-1)])])):s.error?(i(),n("div",De,[e[29]||(e[29]=a("i",{class:"fa fa-exclamation-triangle"},null,-1)),M(" "+d(s.error),1)])):s.filteredGroups.length===0?(i(),n("div",Ie,[e[30]||(e[30]=a("i",{class:"fa fa-users"},null,-1)),s.searchQuery?(i(),n("p",Ee,'Nenhum grupo encontrado para "'+d(s.searchQuery)+'"',1)):(i(),n("p",$e,"Nenhum grupo encontrado"))])):s.viewMode==="card"?(i(),n("div",Te,[(i(!0),n(U,null,W(s.displayGroups,t=>{var C;return i(),n("div",{key:t.JID,class:"group-card",onClick:p=>s.goToGroup(t.JID)},[a("div",Ge,[s.groupPictures[t.JID]?(i(),n("img",{key:0,src:s.groupPictures[t.JID],alt:t.Name,onError:p=>s.handleImageError(t.JID)},null,40,Je)):(i(),n("div",Se,[...e[31]||(e[31]=[a("i",{class:"fa fa-users"},null,-1)])]))]),a("div",Re,[a("div",ze,[a("h3",Be,d(t.Name||"Grupo sem nome"),1),t.lastMessage?(i(),n("span",Le,d(s.formatTime(t.lastMessage.timestamp)),1)):b("",!0)]),a("div",Ve,[t.lastMessage?(i(),n("p",Ae,[a("span",Qe,d(t.lastMessage.senderName)+":",1),M(" "+d(s.truncateMessage(t.lastMessage.text)),1)])):(i(),n("p",Ue,[...e[32]||(e[32]=[a("i",{class:"fa fa-comment-o me-1"},null,-1),M("Sem mensagens recentes ",-1)])]))]),a("div",We,[a("span",qe,[e[33]||(e[33]=a("i",{class:"fa fa-user me-1"},null,-1)),M(d(((C=t.Participants)==null?void 0:C.length)||0),1)]),t.IsAnnounce?(i(),n("span",Fe,[...e[34]||(e[34]=[a("i",{class:"fa fa-bullhorn"},null,-1)])])):b("",!0),t.IsParent?(i(),n("span",je,[...e[35]||(e[35]=[a("i",{class:"fa fa-sitemap"},null,-1)])])):b("",!0)])])],8,Ne)}),128))])):(i(),n("div",Oe,[(i(!0),n(U,null,W(s.displayGroups,t=>{var C;return i(),n("div",{key:t.JID,class:"group-item",onClick:p=>s.goToGroup(t.JID)},[a("div",Ke,[s.groupPictures[t.JID]?(i(),n("img",{key:0,src:s.groupPictures[t.JID],alt:t.Name,onError:p=>s.handleImageError(t.JID)},null,40,Xe)):(i(),n("div",Ye,[...e[36]||(e[36]=[a("i",{class:"fa fa-users"},null,-1)])]))]),a("div",Ze,[a("div",_e,[a("h3",xe,d(t.Name||"Grupo sem nome"),1),t.lastMessage?(i(),n("span",es,d(s.formatTime(t.lastMessage.timestamp)),1)):b("",!0)]),a("div",ss,[t.lastMessage?(i(),n("p",as,[a("span",ts,d(t.lastMessage.senderName)+":",1),M(" "+d(s.truncateMessage(t.lastMessage.text)),1)])):(i(),n("p",os,[a("span",ns,[e[37]||(e[37]=a("i",{class:"fa fa-user me-1"},null,-1)),M(d(((C=t.Participants)==null?void 0:C.length)||0)+" participantes ",1)])]))])]),a("div",is,[t.IsAnnounce?(i(),n("span",ls,[...e[38]||(e[38]=[a("i",{class:"fa fa-bullhorn"},null,-1)])])):b("",!0),t.IsParent?(i(),n("span",rs,[...e[39]||(e[39]=[a("i",{class:"fa fa-sitemap"},null,-1)])])):b("",!0)])],8,He)}),128))])),s.totalPages>1?(i(),n("div",us,[a("button",{onClick:e[11]||(e[11]=t=>s.goToPage(1)),disabled:s.currentPage===1||s.loading,class:"btn-page"},[...e[40]||(e[40]=[a("i",{class:"fa fa-angle-double-left"},null,-1)])],8,ds),a("button",{onClick:e[12]||(e[12]=(...t)=>s.prevPage&&s.prevPage(...t)),disabled:s.currentPage===1||s.loading,class:"btn-page"},[...e[41]||(e[41]=[a("i",{class:"fa fa-angle-left"},null,-1)])],8,ps),a("span",gs,"P√°gina "+d(s.currentPage)+" de "+d(s.totalPages),1),a("button",{onClick:e[13]||(e[13]=(...t)=>s.nextPage&&s.nextPage(...t)),disabled:s.currentPage>=s.totalPages||s.loading,class:"btn-page"},[...e[42]||(e[42]=[a("i",{class:"fa fa-angle-right"},null,-1)])],8,ms),a("button",{onClick:e[14]||(e[14]=t=>s.goToPage(s.totalPages)),disabled:s.currentPage>=s.totalPages||s.loading,class:"btn-page"},[...e[43]||(e[43]=[a("i",{class:"fa fa-angle-double-right"},null,-1)])],8,fs),L(a("select",{"onUpdate:modelValue":e[15]||(e[15]=t=>s.pageSize=t),class:"page-size-select",disabled:s.loading},[...e[44]||(e[44]=[a("option",{value:5},"5 por p√°gina",-1),a("option",{value:10},"10 por p√°gina",-1),a("option",{value:15},"15 por p√°gina",-1),a("option",{value:25},"25 por p√°gina",-1),a("option",{value:50},"50 por p√°gina",-1),a("option",{value:100},"100 por p√°gina",-1),a("option",{value:200},"200 por p√°gina",-1)])],8,vs),[[Q,s.pageSize,void 0,{number:!0}]])])):b("",!0)])}const ys=oe(ue,[["render",cs],["__scopeId","data-v-6c4bb8c9"]]);export{ys as default};
