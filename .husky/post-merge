#!/bin/sh
# Post-merge hook for root AGENTS.md branch isolation.
# Rule:
# - AGENTS.md at repository root is allowed only on custom branches.
# - AGENTS.md must not exist on develop/main/master.

current_branch=$(git rev-parse --abbrev-ref HEAD)

if [ "$current_branch" = "develop" ] || [ "$current_branch" = "main" ] || [ "$current_branch" = "master" ]; then
	if [ -e "AGENTS.md" ]; then
		git rm -f -- AGENTS.md >/dev/null 2>&1 || rm -f AGENTS.md
		if ! git diff --cached --quiet; then
			git commit -m "chore: remove root AGENTS.md after merge on $current_branch"
		fi
	fi
fi

exit 0