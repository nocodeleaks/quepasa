import{d as le,u as ue,r as v,c as L,o as ce,a as y,p as f,b as de,_ as pe,e as u,f as a,h as j,t as m,i as F,j as ge,g as P,F as J,q,k as z,l as me,v as fe,s as c}from"./index.js";const ve=le({setup(){const e=ue(),s=de(),g=e.params.token,k=e.params.id,w=v({}),B=v(""),T=v({}),D=v([]),h=v([]),n=v(!1),$=v(""),C=v(!1),M=v(""),I=v(""),A=v(null),N=v(!1),S=50,H=L(()=>D.value.length),U=L(()=>h.value.length<D.value.length),W=L(()=>{if(!w.value.Participants||!I.value)return!1;const t=w.value.Participants.find(o=>{var r,i;return((r=o.PhoneNumber)==null?void 0:r.includes(I.value))||((i=o.JID)==null?void 0:i.includes(I.value))});return(t==null?void 0:t.IsAdmin)||(t==null?void 0:t.IsSuperAdmin)||!1}),_=L(()=>{const t=w.value.Participants||[];if(!M.value)return t;const o=M.value.toLowerCase();return t.filter(r=>{var i,l,b;return((i=r.DisplayName)==null?void 0:i.toLowerCase().includes(o))||((l=r.PhoneNumber)==null?void 0:l.includes(o))||((b=r.JID)==null?void 0:b.includes(o))})});async function R(){var t,o,r,i;n.value=!0,$.value="",D.value=[],h.value=[];try{const l=await y.get(`/api/groups/get?token=${encodeURIComponent(g)}&groupid=${encodeURIComponent(k)}`);w.value=((t=l.data)==null?void 0:t.groupinfo)||{},O();const p=((o=(await y.get(`/api/server/${g}/info`)).data)==null?void 0:o.wid)||"";I.value=p.replace("@s.whatsapp.net","").replace("@lid",""),await Z(),await Y()}catch(l){$.value=((i=(r=l==null?void 0:l.response)==null?void 0:r.data)==null?void 0:i.result)||(l==null?void 0:l.message)||"Erro ao carregar grupo"}finally{n.value=!1}}async function O(){var t;try{const o=await y.get(`/api/picinfo/${encodeURIComponent(k)}?token=${encodeURIComponent(g)}`);(t=o.data)!=null&&t.url&&(B.value=o.data.url)}catch{}}async function Z(){var o;const t=(w.value.Participants||[]).slice(0,10);for(const r of t){const i=r.PhoneNumber||r.JID;if(i)try{const l=await y.get(`/api/picinfo/${encodeURIComponent(i)}?token=${encodeURIComponent(g)}`);(o=l.data)!=null&&o.url&&(T.value[i]=l.data.url)}catch{}}}function K(t){if(!t)return"";let o=t.replace("@s.whatsapp.net","").replace("@lid","");if(o.length>=12){const r=o.slice(0,2),i=o.slice(2,4),l=o.slice(4,9),b=o.slice(9);return`+${r} ${i} ${l}-${b}`}return o}function Q(t){return t?new Date(t).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):""}function X(t){if(!t)return"";const o=new Date(t),r=new Date,i=r.getTime()-o.getTime(),l=24*60*60*1e3;return i<l&&o.getDate()===r.getDate()?o.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}):i<2*l?"Ontem":i<7*l?o.toLocaleDateString("pt-BR",{weekday:"short"}):o.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"})}async function Y(){var t,o,r;try{const l=((t=(await y.get(`/api/server/${g}/messages`)).data)==null?void 0:t.messages)||[],b=[];for(const p of l){const E=(o=p.chat)==null?void 0:o.id;if(!E||E!==k||p.type==="unhandled"||p.type==="revoked"||p.type==="system"||((r=p.debug)==null?void 0:r.reason)==="discard"||!p.text&&!p.attachment&&!p.inreply)continue;let d=p.text||"";if(p.attachment){const G=p.attachment.mimetype||"";G.startsWith("image/")?d=d?`ðŸ“· ${d}`:"ðŸ“· Imagem":G.startsWith("video/")?d=d?`ðŸŽ¥ ${d}`:"ðŸŽ¥ VÃ­deo":G.startsWith("audio/")||p.type==="ptt"?d=d?`ðŸŽµ ${d}`:"ðŸŽµ Ãudio":G.includes("pdf")?d=d?`ðŸ“„ ${d}`:"ðŸ“„ PDF":d=d?`ðŸ“Ž ${d}`:"ðŸ“Ž Arquivo"}!d&&p.inreply&&(d="â†©ï¸ Resposta"),d&&b.push({...p,text:d})}b.sort((p,E)=>new Date(E.timestamp).getTime()-new Date(p.timestamp).getTime()),D.value=b,h.value=b.slice(0,S)}catch{}}function V(){if(!U.value||N.value)return;N.value=!0;const t=D.value.slice(h.value.length,h.value.length+S);h.value=h.value.concat(t),requestAnimationFrame(()=>{N.value=!1})}function x(){const t=A.value;if(!t||N.value||!U.value)return;t.scrollHeight-(t.scrollTop+t.clientHeight)<160&&V()}function ee(t,o=120){const r=t.text||"";return r.length<=o?r:r.substring(0,o)+"..."}function se(){C.value=!C.value,C.value||(M.value="")}async function te(){var t,o;if(confirm("Deseja realmente sair do grupo?"))try{await y.post("/api/groups/leave",{token:g,group_jid:k}),f("SaÃ­da do grupo solicitada","success"),s.push(`/server/${g}/groups`)}catch(r){f(((o=(t=r==null?void 0:r.response)==null?void 0:t.data)==null?void 0:o.result)||(r==null?void 0:r.message)||"Erro ao sair do grupo","error")}}async function ae(){var o,r;const t=prompt("Novo nome do grupo (<=25 caracteres):",w.value.Name||"");if(t)try{await y.put("/api/groups/name",{token:g,group_jid:k,name:t}),f("Nome do grupo atualizado","success"),await R()}catch(i){f(((r=(o=i==null?void 0:i.response)==null?void 0:o.data)==null?void 0:r.result)||(i==null?void 0:i.message)||"Erro ao atualizar nome","error")}}async function oe(){var o,r;const t=prompt("Nova descriÃ§Ã£o do grupo:",w.value.Topic||"");if(t!=null)try{await y.put("/api/groups/description",{token:g,group_jid:k,topic:t}),f("DescriÃ§Ã£o atualizada","success"),await R()}catch(i){f(((r=(o=i==null?void 0:i.response)==null?void 0:o.data)==null?void 0:r.result)||(i==null?void 0:i.message)||"Erro ao atualizar descriÃ§Ã£o","error")}}async function ie(){var r,i;const t=prompt("Telefone(s) para adicionar (separados por vÃ­rgula):");if(!t)return;const o=t.split(",").map(l=>l.trim()).filter(Boolean);try{await y.put("/api/groups/participants",{token:g,group_jid:k,participants:o}),f("Participantes adicionados","success"),await R()}catch(l){f(((i=(r=l==null?void 0:l.response)==null?void 0:r.data)==null?void 0:i.result)||(l==null?void 0:l.message)||"Erro ao adicionar participante","error")}}async function ne(){var o,r;const t=prompt("URL da imagem do grupo (ou vazio para cancelar):");if(t)try{await y.put("/api/groups/photo",{token:g,group_jid:k,image_url:t}),f("Foto do grupo atualizada","success"),await R()}catch(i){f(((r=(o=i==null?void 0:i.response)==null?void 0:o.data)==null?void 0:r.result)||(i==null?void 0:i.message)||"Erro ao alterar foto","error")}}async function re(){var t,o,r;try{const l=(t=(await y.get(`/api/invite?chatid=${encodeURIComponent(k)}&token=${encodeURIComponent(g)}`)).data)==null?void 0:t.url;l?(await navigator.clipboard.writeText(l),f("Link copiado para a Ã¡rea de transferÃªncia!","success")):f("Nenhum link de convite disponÃ­vel","error")}catch(i){f(((r=(o=i==null?void 0:i.response)==null?void 0:o.data)==null?void 0:r.result)||(i==null?void 0:i.message)||"Erro ao obter link","error")}}return ce(()=>{R()}),{token:g,group:w,groupPicture:B,participantPictures:T,messages:D,visibleMessages:h,loading:n,error:$,isAdmin:W,showSearch:C,participantSearch:M,totalMessages:H,hasMoreMessages:U,isLoadingMore:N,messagesListRef:A,filteredParticipants:_,formatPhone:K,formatDate:Q,formatTime:X,messagePreview:ee,loadMoreMessages:V,onMessagesScroll:x,searchParticipants:se,leaveGroup:te,setGroupName:ae,setGroupTopic:oe,setGroupPhoto:ne,addParticipant:ie,getInvite:re}}}),he={class:"group-detail-page"},ye={key:0,class:"loading-container"},ke={key:1,class:"error-container"},be={key:2,class:"group-layout"},Pe={class:"messages-column"},we={class:"messages-header"},De={key:0},Ne={class:"message-avatar"},Ce=["src"],Me={key:1,class:"avatar-placeholder-small"},Ie={class:"message-content"},$e={class:"message-meta"},Te={class:"message-sender"},Ae={class:"message-time"},Se={class:"message-text"},Re={key:0,class:"load-more-state"},Ee={key:1,class:"load-more-state"},Ge={key:2,class:"load-more-state muted"},Le={key:1,class:"empty-messages"},Be={class:"details-column"},Ue={class:"group-header"},Ve={class:"group-photo-container"},je=["src","alt"],Fe={key:1,class:"group-photo-placeholder"},Je={class:"group-name"},qe={class:"group-meta"},ze={key:0,class:"section"},He={class:"section-header"},We={key:0,class:"description-text"},_e={key:1,class:"description-empty"},Oe={key:2,class:"description-meta"},Ze={class:"section actions-section"},Ke={class:"section"},Qe={class:"section-header"},Xe={key:0,class:"search-box"},Ye={class:"participants-list"},xe={class:"participant-avatar"},es=["src","alt"],ss={key:1,class:"avatar-placeholder"},ts={class:"participant-info"},as={class:"participant-name"},os={key:0},is={key:1},ns={key:0,class:"participant-phone"},rs={class:"participant-badges"},ls={key:0,class:"badge badge-owner"},us={key:1,class:"badge badge-admin"},cs={class:"section danger-section"};function ds(e,s,g,k,w,B){var D,h;const T=ge("router-link");return c(),u("div",he,[e.loading?(c(),u("div",ye,[...s[10]||(s[10]=[a("div",{class:"loading-spinner"},null,-1),a("p",null,"Carregando grupo...",-1)])])):e.error?(c(),u("div",ke,[s[12]||(s[12]=a("i",{class:"fa fa-exclamation-triangle"},null,-1)),a("p",null,m(e.error),1),j(T,{to:`/server/${e.token}/groups`,class:"btn-back"},{default:F(()=>[...s[11]||(s[11]=[z("Voltar aos grupos",-1)])]),_:1},8,["to"])])):(c(),u("div",be,[a("div",Pe,[a("div",we,[s[13]||(s[13]=a("div",null,[a("p",{class:"eyebrow"},"HistÃ³rico recente"),a("h2",null,"Mensagens")],-1)),e.totalMessages?(c(),u("small",De,m(e.visibleMessages.length)+" de "+m(e.totalMessages)+" mensagens",1)):P("",!0)]),e.visibleMessages.length?(c(),u("div",{key:0,class:"messages-list",ref:"messagesListRef",onScrollPassive:s[1]||(s[1]=(...n)=>e.onMessagesScroll&&e.onMessagesScroll(...n))},[(c(!0),u(J,null,q(e.visibleMessages,n=>{var $,C,M,I,A,N,S;return c(),u("div",{key:n.id,class:"message-item"},[a("div",Ne,[e.participantPictures[(($=n.participant)==null?void 0:$.phone)||((C=n.participant)==null?void 0:C.id)]?(c(),u("img",{key:0,src:e.participantPictures[((M=n.participant)==null?void 0:M.phone)||((I=n.participant)==null?void 0:I.id)]},null,8,Ce)):(c(),u("div",Me,[...s[14]||(s[14]=[a("i",{class:"fa fa-user"},null,-1)])]))]),a("div",Ie,[a("div",$e,[a("span",Te,m(((A=n.participant)==null?void 0:A.title)||e.formatPhone(((N=n.participant)==null?void 0:N.phone)||((S=n.participant)==null?void 0:S.id))),1),a("span",Ae,m(e.formatTime(n.timestamp)),1)]),a("div",Se,m(e.messagePreview(n)),1)])])}),128)),e.isLoadingMore?(c(),u("div",Re,"Carregando mais mensagens...")):e.hasMoreMessages?(c(),u("div",Ee,[a("button",{class:"load-more-btn",type:"button",onClick:s[0]||(s[0]=(...n)=>e.loadMoreMessages&&e.loadMoreMessages(...n))},"Carregar mais 50")])):(c(),u("div",Ge," VocÃª chegou ao inÃ­cio do histÃ³rico "))],544)):(c(),u("div",Le,"Nenhuma mensagem recente"))]),a("div",Be,[a("div",Ue,[j(T,{to:`/server/${e.token}/groups`,class:"back-btn"},{default:F(()=>[...s[15]||(s[15]=[a("i",{class:"fa fa-arrow-left"},null,-1)])]),_:1},8,["to"]),a("div",Ve,[e.groupPicture?(c(),u("img",{key:0,src:e.groupPicture,alt:e.group.Name,class:"group-photo"},null,8,je)):(c(),u("div",Fe,[...s[16]||(s[16]=[a("i",{class:"fa fa-users"},null,-1)])])),e.isAdmin?(c(),u("button",{key:2,onClick:s[2]||(s[2]=(...n)=>e.setGroupPhoto&&e.setGroupPhoto(...n)),class:"edit-photo-btn",title:"Alterar foto"},[...s[17]||(s[17]=[a("i",{class:"fa fa-camera"},null,-1)])])):P("",!0)]),a("h1",Je,[z(m(e.group.Name||"Grupo sem nome")+" ",1),e.isAdmin?(c(),u("button",{key:0,onClick:s[3]||(s[3]=(...n)=>e.setGroupName&&e.setGroupName(...n)),class:"edit-btn",title:"Alterar nome"},[...s[18]||(s[18]=[a("i",{class:"fa fa-pencil"},null,-1)])])):P("",!0)]),a("p",qe," Grupo Â· "+m(((D=e.group.Participants)==null?void 0:D.length)||0)+" membros ",1)]),e.group.Topic||e.isAdmin?(c(),u("div",ze,[a("div",He,[s[20]||(s[20]=a("i",{class:"fa fa-info-circle"},null,-1)),s[21]||(s[21]=a("span",null,"DescriÃ§Ã£o",-1)),e.isAdmin?(c(),u("button",{key:0,onClick:s[4]||(s[4]=(...n)=>e.setGroupTopic&&e.setGroupTopic(...n)),class:"edit-btn",title:"Alterar descriÃ§Ã£o"},[...s[19]||(s[19]=[a("i",{class:"fa fa-pencil"},null,-1)])])):P("",!0)]),e.group.Topic?(c(),u("p",We,m(e.group.Topic),1)):(c(),u("p",_e,"Nenhuma descriÃ§Ã£o definida")),e.group.TopicSetAt?(c(),u("p",Oe," Criada em "+m(e.formatDate(e.group.TopicSetAt)),1)):P("",!0)])):P("",!0),a("div",Ze,[a("button",{class:"action-btn",onClick:s[5]||(s[5]=(...n)=>e.getInvite&&e.getInvite(...n))},[...s[22]||(s[22]=[a("i",{class:"fa fa-link"},null,-1),a("span",null,"Link de convite",-1)])]),e.isAdmin?(c(),u("button",{key:0,class:"action-btn",onClick:s[6]||(s[6]=(...n)=>e.addParticipant&&e.addParticipant(...n))},[...s[23]||(s[23]=[a("i",{class:"fa fa-user-plus"},null,-1),a("span",null,"Adicionar",-1)])])):P("",!0),a("button",{class:"action-btn",onClick:s[7]||(s[7]=(...n)=>e.searchParticipants&&e.searchParticipants(...n))},[...s[24]||(s[24]=[a("i",{class:"fa fa-search"},null,-1),a("span",null,"Pesquisar",-1)])])]),a("div",Ke,[a("div",Qe,[s[25]||(s[25]=a("i",{class:"fa fa-users"},null,-1)),a("span",null,m(((h=e.group.Participants)==null?void 0:h.length)||0)+" membros",1)]),e.showSearch?(c(),u("div",Xe,[me(a("input",{"onUpdate:modelValue":s[8]||(s[8]=n=>e.participantSearch=n),type:"text",placeholder:"Pesquisar membros...",class:"search-input"},null,512),[[fe,e.participantSearch]])])):P("",!0),a("div",Ye,[(c(!0),u(J,null,q(e.filteredParticipants,n=>(c(),u("div",{key:n.JID,class:"participant-item"},[a("div",xe,[e.participantPictures[n.PhoneNumber||n.JID]?(c(),u("img",{key:0,src:e.participantPictures[n.PhoneNumber||n.JID],alt:n.DisplayName},null,8,es)):(c(),u("div",ss,[...s[26]||(s[26]=[a("i",{class:"fa fa-user"},null,-1)])]))]),a("div",ts,[a("div",as,[n.DisplayName?(c(),u("span",os,"~ "+m(n.DisplayName),1)):(c(),u("span",is,m(e.formatPhone(n.PhoneNumber||n.JID)),1))]),n.DisplayName&&n.PhoneNumber?(c(),u("div",ns,m(e.formatPhone(n.PhoneNumber)),1)):P("",!0)]),a("div",rs,[n.IsSuperAdmin?(c(),u("span",ls,"Criador")):n.IsAdmin?(c(),u("span",us,"Admin")):P("",!0)])]))),128))])]),a("div",cs,[a("button",{class:"danger-btn",onClick:s[9]||(s[9]=(...n)=>e.leaveGroup&&e.leaveGroup(...n))},[...s[27]||(s[27]=[a("i",{class:"fa fa-sign-out"},null,-1),a("span",null,"Sair do grupo",-1)])])])])]))])}const gs=pe(ve,[["render",ds],["__scopeId","data-v-1c61b59e"]]);export{gs as default};
